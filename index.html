<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jade Heaven: Sovereign Edition</title>
    <style>
        :root { --realm-color: #d4af37; --glow: 0 0 10px #d4af37; }
        body { 
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://r.jina.ai/i/9e0e3b91c89047978935c102a9b3699c') no-repeat center center fixed; 
            background-size: cover; color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; justify-content: center; padding: 20px; margin: 0;
            overflow-x: hidden;
        }
        #game-box { 
            background: rgba(10, 15, 12, 0.95); backdrop-filter: blur(15px); 
            border: 3px solid var(--realm-color); padding: 25px; width: 1100px; 
            border-radius: 15px; box-shadow: 0 0 50px #000; transition: all 1s ease;
            position: relative;
        }
        .layout { display: grid; grid-template-columns: 280px 1fr 280px; gap: 20px; }
        .panel { background: rgba(255,255,255,0.03); border: 1px solid rgba(255, 255, 255, 0.1); padding: 15px; border-radius: 10px; }
        h3 { color: var(--realm-color); border-bottom: 1px solid var(--realm-color); margin-top: 0; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; text-shadow: var(--glow); }
        
        #avatar-frame { width: 100%; height: 220px; border: 2px solid var(--realm-color); border-radius: 8px; overflow: hidden; margin-bottom: 10px; box-shadow: var(--glow); background: #000; }
        #avatar-img { width: 100%; height: 100%; object-fit: cover; }

        button { background: #1a261f; color: #ffd700; border: 1px solid #d4af37; padding: 10px; cursor: pointer; width: 100%; margin-top: 8px; font-weight: bold; transition: 0.2s; }
        button:hover:not(:disabled) { background: var(--realm-color); color: #000; box-shadow: var(--glow); }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        
        #log { height: 100px; overflow-y: auto; background: rgba(0,0,0,0.8); color: #00ff00; padding: 10px; font-size: 0.8rem; margin-top: 15px; border-radius: 5px; font-family: 'Courier New'; border-left: 3px solid var(--realm-color); }
        .treasure-tag { display: inline-block; padding: 4px 10px; background: #2a0000; border: 1px solid #ff4444; font-size: 0.75rem; margin: 3px; border-radius: 4px; color: #ffcccc; }
        progress { width: 100%; height: 12px; accent-color: var(--realm-color); margin: 10px 0; }
        .stat-val { color: var(--realm-color); font-weight: bold; }

        /* Battle Animations */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .battle-shake { animation: shake 0.5s; animation-iteration-count: infinite; }
        .battle-flash { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: white; opacity: 0; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>
<div class="battle-flash" id="flash"></div>
<div id="game-box">
    <div id="setup" style="text-align:center; padding: 40px;">
        <h1 style="color:#d4af37; text-shadow: 0 0 20px #d4af37;">JADE HEAVEN</h1>
        <p>Your legend begins here.</p>
        <input type="text" id="player-name" placeholder="Daoist Name..." style="padding:12px; width:250px; background: #000; color: #ffd700; border: 1px solid #d4af37; border-radius: 5px;">
        <button onclick="startGame()" style="width:200px; margin-top: 20px;">Awaken Meridians</button>
    </div>

    <div id="main-game" style="display:none;">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="color: var(--realm-color); margin:0;">Sect Master <span id="display-name">Daoist</span></h2>
            <div style="display:flex; gap: 10px;">
                <button onclick="saveGame()" style="padding: 5px 10px; font-size: 0.7rem; width: auto;">Seal Save</button>
                <button onclick="deleteSave()" style="padding: 5px 10px; font-size: 0.7rem; background: #4a0000; border-color: #ff4444; width: auto;">Shatter Save</button>
                <div style="padding: 5px 10px; border: 1px solid var(--realm-color); border-radius: 5px; font-size: 0.8rem;">Karma: <span class="stat-val" id="karma-display">1.0</span>x</div>
            </div>
        </div>
        
        <div class="layout">
            <div class="panel">
                <div id="avatar-frame">
                    <img id="avatar-img" src="gamechar.jpg" alt="Sect Leader">
                </div>
                <h3>Cultivation</h3>
                <div>Realm: <span id="realm" class="stat-val">Mortal</span></div>
                <div>Qi: <span id="qi" class="stat-val">0</span> / <span id="qi-req" class="stat-val">0</span></div>
                <progress id="qi-bar" value="0" max="100"></progress>
                <div>Stones: <span id="stones" class="stat-val">0</span></div>
                <button onclick="meditate()">Meditate (Gain Qi)</button>
                <button onclick="mineStones()">Mine Spirit Stones (+10)</button>
                <button id="bt-btn" style="display:none; background: #4a0000; border-color: #ff0000;" onclick="attemptBreakthrough()">ATTEMPT BREAKTHROUGH</button>
            </div>

            <div class="panel">
                <h3>War Map (Sect Wars)</h3>
                <div style="background: rgba(50, 0, 0, 0.4); border: 1px solid #ff4444; padding: 12px; border-radius: 8px;">
                    <p id="target-sect" style="margin: 0 0 10px 0;">Target: <b>Green Bamboo Sect</b></p>
                    <p style="font-size: 0.8rem;">Power Needed: <span id="sect-power-req" class="stat-val">1,000</span></p>
                    <button id="war-btn" onclick="invadeSect()">Launch Invasion</button>
                </div>

                <h3 style="margin-top:20px;">Heavenly Treasures</h3>
                <div id="treasures-list" style="min-height: 50px;">None collected yet.</div>

                <h3 style="margin-top:20px;">World Boss</h3>
                <div style="text-align: center; border: 1px solid var(--realm-color); padding: 10px; border-radius: 8px;">
                    <p id="boss-name" style="color: #ff4444; font-weight: bold; margin: 5px 0;">...</p>
                    <p style="font-size: 0.8rem;">Boss Power: <span id="boss-power" class="stat-val">?</span></p>
                    <button id="boss-btn" onclick="challengeBoss()">Challenge Boss</button>
                </div>
            </div>

            <div class="panel">
                <h3>Sect Hall</h3>
                <button onclick="recruit('disciple')">Outer Disciple (50s)</button>
                <button onclick="recruit('elder')">Inner Elder (500s)</button>
                <button onclick="recruit('array')">Array Grandmaster (2.5k)</button>
                
                <div style="margin-top:20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
                    <div>Disciples: <span id="c-disciple" class="stat-val">0</span></div>
                    <div>Elders: <span id="c-elder" class="stat-val">0</span></div>
                    <div style="font-size: 1.1rem; margin-top: 10px;">Combat Power: <br><span id="power" style="font-size: 1.5rem; color: #ff4444; text-shadow: 0 0 5px #000;">0</span></div>
                </div>
                
                <div class="panel" style="background: rgba(70,0,0,0.3); border-color: #ff4444; margin-top: 20px;">
                    <h3 style="border-bottom-color: #ff4444; color: #ff4444;">Reincarnation</h3>
                    <p style="font-size: 0.7rem;">Gain +<span id="potential-karma">0</span> Karma</p>
                    <button id="reborn-btn" onclick="reincarnate()" disabled>Reincarnate</button>
                </div>
            </div>
        </div>
        <div id="log">The Jade Heaven Sect awaits your command.</div>
    </div>
</div>

<script>
    let karma = 1.0;
    let treasures = [];
    let state = {
        name: "Daoist", qi: 0, stones: 50, realmIdx: 0, bossIdx: 0, sectIdx: 0,
        counts: { disciple: 0, elder: 0, array: 0 },
        realms: ["Qi Condensation", "Foundation Establishment", "Core Formation", "Nascent Soul", "Spirit Severing", "Void Refinement", "Mahayana", "Immortal Emperor"],
        sects: [
            { name: "Green Bamboo Sect", req: 1000, reward: "Jade Flute (+10% Qi)" },
            { name: "Thunder Mountain", req: 8000, reward: "Lightning Orb (+20% Power)" },
            { name: "Black Lotus Cult", req: 50000, reward: "Lotus Petal (+50% Stones)" },
            { name: "Heavenly Sword Sect", req: 250000, reward: "Void Blade (+100% Power)" }
        ],
        bosses: [
            { name: "Iron-Tusk Boar", power: 500 },
            { name: "Shadow Assassin", power: 4000 },
            { name: "Ancient Chimera", power: 25000 },
            { name: "God-Killer Golem", power: 150000 },
            { name: "Heavenly Will", power: 1000000 }
        ]
    };

    function startGame() {
        const nameInput = document.getElementById('player-name').value;
        if (nameInput) state.name = nameInput;
        document.getElementById('display-name').innerText = state.name;
        document.getElementById('setup').style.display = 'none';
        document.getElementById('main-game').style.display = 'block';
        update();
    }

    function log(msg, color="#00ff00") {
        const lb = document.getElementById('log');
        lb.innerHTML = `<span style="color:${color}">> ${msg}</span><br>${lb.innerHTML}`;
    }

    function update() {
        let req = (state.realmIdx + 1) * 300 * Math.pow(2.2, state.realmIdx);
        document.getElementById('qi').innerText = Math.floor(state.qi);
        document.getElementById('qi-req').innerText = Math.floor(req);
        document.getElementById('qi-bar').value = (state.qi / req) * 100;
        document.getElementById('stones').innerText = Math.floor(state.stones);
        document.getElementById('realm').innerText = state.realms[state.realmIdx] || "Supreme God";
        document.getElementById('karma-display').innerText = karma.toFixed(2);
        
        let pwr = (state.realmIdx * 2500) + (state.counts.elder * 600) + (state.counts.disciple * 60);
        if(treasures.includes("Lightning Orb (+20% Power)")) pwr *= 1.2;
        if(treasures.includes("Void Blade (+100% Power)")) pwr *= 2.0;
        document.getElementById('power').innerText = Math.floor(pwr);
        
        document.getElementById('c-disciple').innerText = state.counts.disciple;
        document.getElementById('c-elder').innerText = state.counts.elder;
        
        document.getElementById('bt-btn').style.display = (state.qi >= req) ? "block" : "none";
        document.getElementById('reborn-btn').disabled = state.realmIdx < 3;
        document.getElementById('potential-karma').innerText = (state.realmIdx * 0.5 + state.bossIdx).toFixed(1);

        const colors = ["#d4af37", "#4db8ff", "#9d4dff", "#ff4d4d", "#ffffff"];
        let colorIdx = Math.min(Math.floor(state.realmIdx / 2), colors.length - 1);
        document.documentElement.style.setProperty('--realm-color', colors[colorIdx]);
        document.documentElement.style.setProperty('--glow', `0 0 10px ${colors[colorIdx]}`);

        if(state.sectIdx < state.sects.length) {
            document.getElementById('target-sect').innerHTML = `Target: <b>${state.sects[state.sectIdx].name}</b>`;
            document.getElementById('sect-power-req').innerText = state.sects[state.sectIdx].req.toLocaleString();
        } else {
            document.getElementById('target-sect').innerText = "World Conquered!";
            document.getElementById('war-btn').disabled = true;
        }

        if(state.bossIdx < state.bosses.length) {
            document.getElementById('boss-name').innerText = state.bosses[state.bossIdx].name;
            document.getElementById('boss-power').innerText = state.bosses[state.bossIdx].power.toLocaleString();
        } else {
            document.getElementById('boss-name').innerText = "All Bosses Slain!";
        }
    }

    function meditate() { 
        let bonus = treasures.includes("Jade Flute (+10% Qi)") ? 1.1 : 1.0;
        state.qi += (10 + (state.realmIdx * 20)) * karma * bonus; 
        update(); 
    }

    function mineStones() { 
        let bonus = treasures.includes("Lotus Petal (+50% Stones)") ? 1.5 : 1.0;
        state.stones += 10 * karma * bonus; 
        update(); 
    }

    function recruit(type) {
        let costs = { disciple: 50, elder: 500, array: 2500 };
        if (state.stones >= costs[type]) {
            state.stones -= costs[type];
            state.counts[type]++;
            update();
        } else { log("Insufficient Spirit Stones!", "red"); }
    }

    function invadeSect() {
        let sect = state.sects[state.sectIdx];
        let pwr = parseInt(document.getElementById('power').innerText);
        if (pwr >= sect.req) {
            treasures.push(sect.reward);
            state.sectIdx++;
            log(`Success! You conquered ${sect.name} and found ${sect.reward}!`, "gold");
            renderTreasures();
        } else { log("Your invasion force was decimated!", "red"); }
        update();
    }

    function challengeBoss() {
        let boss = state.bosses[state.bossIdx];
        let pwr = parseInt(document.getElementById('power').innerText);
        let gameBox = document.getElementById('game-box');
        let flash = document.getElementById('flash');

        // Start Battle Animation
        gameBox.classList.add('battle-shake');
        flash.style.opacity = '0.5';
        document.getElementById('boss-btn').disabled = true;
        
        log(`Engaging ${boss.name} in mortal combat...`, "orange");

        setTimeout(() => {
            gameBox.classList.remove('battle-shake');
            flash.style.opacity = '0';
            document.getElementById('boss-btn').disabled = false;

            if (pwr >= boss.power) {
                state.stones += boss.power;
                state.bossIdx++;
                log(`VICTORY! You defeated ${boss.name}. Looted ${boss.power} stones.`, "gold");
            } else {
                state.qi *= 0.5;
                log(`DEFEAT! ${boss.name} crushed your cultivation. Lost 50% Qi.`, "red");
            }
            update();
        }, 1500);
    }

    function attemptBreakthrough() {
        state.realmIdx++;
        state.qi = 0;
        log(`ASCENDED: You are now at the ${state.realms[state.realmIdx]} realm!`, "cyan");
        update();
    }

    function reincarnate() {
        karma += (state.realmIdx * 0.5 + state.bossIdx);
        state.qi = 0; state.stones = 50; state.realmIdx = 0; state.bossIdx = 0; state.sectIdx = 0;
        state.counts = {disciple:0, elder:0, array:0};
        log("REBIRTH: You return to the mortal world with supreme talent.");
        update();
    }

    function renderTreasures() {
        const list = document.getElementById('treasures-list');
        list.innerHTML = treasures.map(t => `<span class="treasure-tag">${t}</span>`).join("");
    }

    function saveGame() {
        localStorage.setItem('jadeHeavenFullSave', JSON.stringify({state, karma, treasures}));
        log("Game State Sealed.", "white");
    }

    function deleteSave() {
        if(confirm("Are you sure you want to shatter your cultivation? This will delete all save data forever.")) {
            localStorage.removeItem('jadeHeavenFullSave');
            location.reload();
        }
    }

    // Auto-load
    const saved = localStorage.getItem('jadeHeavenFullSave');
    if(saved) {
        const data = JSON.parse(saved);
        state = data.state; karma = data.karma; treasures = data.treasures;
        renderTreasures();
        startGame(); 
    }

    // Passive Generation
    setInterval(() => {
        let stoneBonus = treasures.includes("Lotus Petal (+50% Stones)") ? 1.5 : 1.0;
        let qiBonus = treasures.includes("Jade Flute (+10% Qi)") ? 1.1 : 1.0;
        state.stones += (state.counts.disciple * 2 * karma * stoneBonus);
        state.qi += (state.counts.elder * 15 * karma * qiBonus);
        update();
    }, 1000);

    update();
</script>
</body>
</html>
